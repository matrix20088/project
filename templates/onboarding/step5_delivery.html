{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card border-primary shadow">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">
                        <i class="fas fa-dolly me-2"></i>
                        استلام المواد وإكمال العملية
                    </h3>
                    <span class="badge bg-light text-primary">الخطوة {{ current_step }} من {{ total_steps }}</span>
                </div>
                <div class="card-body p-4">
                    <!-- شريط التقدم -->
                    <div class="progress mb-4" style="height: 10px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ (current_step / total_steps) * 100 }}%;" 
                            aria-valuenow="{{ (current_step / total_steps) * 100 }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    <div class="text-center mb-4">
                        <img src="{{ url_for('static', filename='img/delivery.svg') }}" alt="الاستلام" class="img-fluid mb-3" style="max-height: 200px;">
                        <h2 class="text-primary">استلام المواد وإكمال دورة المشتريات</h2>
                        <p class="text-muted">خطوات استلام المواد، والتحقق منها، وإغلاق أوامر الشراء</p>
                    </div>
                    
                    <!-- نظرة عامة -->
                    <div class="card border-light mb-4">
                        <div class="card-body">
                            <h4 class="text-primary mb-3">استلام المواد: الخطوة الأخيرة في دورة المشتريات</h4>
                            
                            <p>بعد إصدار أمر الشراء وموافقة المورد، تأتي مرحلة استلام المواد والتي تُعد من أهم المراحل في دورة المشتريات. حيث يتم التحقق من مطابقة المواد المستلمة للمواصفات والكميات المطلوبة، وتوثيق عملية الاستلام في النظام.</p>
                            
                            <div class="alert alert-info mt-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>لماذا تُعتبر عملية الاستلام مهمة؟</strong>
                                <p class="mb-0 mt-2">تُعتبر عملية استلام المواد نقطة التحقق النهائية من جودة ومطابقة المشتريات، وهي الخطوة التي تسبق إتمام الدفع النهائي للمورد. كما أنها توثق وصول المواد فعلياً للمشروع وتبدأ مرحلة استهلاكها.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- مسؤوليات استلام المواد -->
                    <div class="card border-info mb-4">
                        <div class="card-header bg-info text-dark">
                            <h4 class="mb-0"><i class="fas fa-users me-2"></i>من المسؤول عن استلام المواد؟</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="role-card">
                                        <div class="role-icon site-engineer">
                                            <i class="fas fa-hard-hat"></i>
                                        </div>
                                        <div class="role-details">
                                            <h5>مهندس الموقع</h5>
                                            <p>مسؤول عن:</p>
                                            <ul>
                                                <li>فحص المواصفات الفنية للمواد</li>
                                                <li>التحقق من مطابقة المواد للمواصفات المطلوبة</li>
                                                <li>رفض أي مواد لا تتوافق مع المعايير المطلوبة</li>
                                                <li>توثيق أي انحرافات عن المواصفات المطلوبة</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="role-card">
                                        <div class="role-icon storekeeper">
                                            <i class="fas fa-warehouse"></i>
                                        </div>
                                        <div class="role-details">
                                            <h5>أمين المستودع</h5>
                                            <p>مسؤول عن:</p>
                                            <ul>
                                                <li>التحقق من الكميات المستلمة</li>
                                                <li>فحص سلامة العبوات والتغليف</li>
                                                <li>توثيق استلام المواد في النظام</li>
                                                <li>ترتيب وتخزين المواد المستلمة</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-lg-6">
                                    <div class="role-card">
                                        <div class="role-icon project-manager">
                                            <i class="fas fa-user-tie"></i>
                                        </div>
                                        <div class="role-details">
                                            <h5>مدير المشروع</h5>
                                            <p>مسؤول عن:</p>
                                            <ul>
                                                <li>المصادقة النهائية على محاضر الاستلام</li>
                                                <li>اعتماد إشعارات الاستلام للدفع</li>
                                                <li>متابعة حل المشكلات مع الموردين</li>
                                                <li>ضمان توثيق عملية الاستلام بشكل سليم</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="role-card">
                                        <div class="role-icon finance">
                                            <i class="fas fa-calculator"></i>
                                        </div>
                                        <div class="role-details">
                                            <h5>قسم المالية</h5>
                                            <p>مسؤول عن:</p>
                                            <ul>
                                                <li>مطابقة وثائق الاستلام مع الفواتير</li>
                                                <li>إعداد إجراءات الدفع للموردين</li>
                                                <li>تحديث السجلات المالية للمشروع</li>
                                                <li>حفظ وأرشفة المستندات للمراجعة المالية</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- خطوات استلام المواد -->
                    <div class="card border-success mb-4">
                        <div class="card-header bg-success text-white">
                            <h4 class="mb-0"><i class="fas fa-list-ol me-2"></i>خطوات استلام المواد في النظام</h4>
                        </div>
                        <div class="card-body">
                            <div class="delivery-process">
                                <div class="delivery-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h5>الإعداد لاستلام الطلبية</h5>
                                        <p>قبل وصول المواد، تأكد من:</p>
                                        <ul>
                                            <li>الاطلاع على أمر الشراء وتفاصيل المواد المتوقع استلامها</li>
                                            <li>تجهيز مكان التخزين المناسب للمواد</li>
                                            <li>توفير الأدوات اللازمة للفحص (أدوات قياس، معدات اختبار، إلخ)</li>
                                            <li>طباعة نموذج استلام المواد من النظام</li>
                                        </ul>
                                        <div class="text-center mt-2 mb-3">
                                            <button class="btn btn-sm btn-outline-success" disabled>
                                                <i class="fas fa-print me-1"></i>
                                                طباعة نموذج الاستلام
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="delivery-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h5>استقبال الطلبية وفحص المستندات</h5>
                                        <p>عند وصول الشحنة:</p>
                                        <ul>
                                            <li>التحقق من مستندات التسليم (فاتورة، إشعار شحن، شهادات جودة)</li>
                                            <li>التأكد من مطابقة تفاصيل المستندات مع أمر الشراء</li>
                                            <li>فحص سلامة العبوات والتغليف الخارجي</li>
                                            <li>توقيع إشعار استلام مبدئي للناقل إذا كانت الشحنة سليمة ظاهرياً</li>
                                        </ul>
                                        <div class="alert alert-warning">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            إذا كانت هناك أضرار واضحة في الشحنة، قم بتوثيقها بالصور وذكرها في إشعار الاستلام
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="delivery-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h5>الفحص التفصيلي للمواد</h5>
                                        <p>قم بإجراء فحص شامل للمواد المستلمة:</p>
                                        <ul>
                                            <li>التحقق من الكميات المستلمة ومطابقتها للكميات المطلوبة</li>
                                            <li>فحص المواصفات الفنية للمواد (الأبعاد، الوزن، النوع، إلخ)</li>
                                            <li>اختبار العينات إذا كان ذلك مطلوباً</li>
                                            <li>التأكد من تواريخ الصلاحية (إن وجدت)</li>
                                            <li>التحقق من مطابقة الجودة للمعايير المطلوبة</li>
                                        </ul>
                                        <div class="text-center my-3">
                                            <img src="{{ url_for('static', filename='img/inspection.svg') }}" alt="فحص المواد" class="inspection-img">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="delivery-step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <h5>تسجيل الاستلام في النظام</h5>
                                        <p>بعد الانتهاء من الفحص، قم بتوثيق عملية الاستلام في النظام:</p>
                                        <ol>
                                            <li>انتقل إلى قائمة "أوامر الشراء" في النظام</li>
                                            <li>ابحث عن أمر الشراء المعني واختر "تسجيل استلام"</li>
                                            <li>أدخل تفاصيل المواد المستلمة (الكميات، تاريخ الاستلام، حالة المواد)</li>
                                            <li>أرفق المستندات الداعمة (صور، محاضر استلام، شهادات فحص)</li>
                                            <li>أدخل أي ملاحظات متعلقة بالاستلام</li>
                                            <li>اضغط على "حفظ" لتوثيق عملية الاستلام</li>
                                        </ol>
                                        <div class="text-center mt-2 mb-3">
                                            <button class="btn btn-primary" disabled>
                                                <i class="fas fa-save me-1"></i>
                                                حفظ محضر الاستلام
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="delivery-step">
                                    <div class="step-number">5</div>
                                    <div class="step-content">
                                        <h5>التعامل مع الاختلافات والمشكلات</h5>
                                        <p>في حال وجود اختلافات بين ما تم استلامه وما هو مطلوب:</p>
                                        <ul>
                                            <li>توثيق الاختلافات بشكل دقيق (نوع، كمية، جودة)</li>
                                            <li>إبلاغ المورد فوراً بالمشكلات المكتشفة</li>
                                            <li>استخدام خيار "استلام جزئي" في النظام إذا تم قبول جزء من الشحنة</li>
                                            <li>تحديد الإجراء المناسب (إرجاع، استبدال، خصم على الفاتورة)</li>
                                        </ul>
                                        <div class="action-buttons mt-2">
                                            <button class="btn btn-sm btn-outline-warning me-2" disabled>
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                تسجيل اختلاف
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" disabled>
                                                <i class="fas fa-times-circle me-1"></i>
                                                رفض استلام
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="delivery-step">
                                    <div class="step-number">6</div>
                                    <div class="step-content">
                                        <h5>الاعتماد النهائي وإغلاق أمر الشراء</h5>
                                        <p>بعد اكتمال عملية الاستلام بنجاح:</p>
                                        <ul>
                                            <li>يقوم مدير المشروع بمراجعة واعتماد محضر الاستلام</li>
                                            <li>يتم إرسال إشعار للقسم المالي بإتمام الاستلام للبدء في إجراءات الدفع</li>
                                            <li>يتم تحديث حالة أمر الشراء في النظام إلى "مكتمل"</li>
                                            <li>يتم إضافة المواد المستلمة إلى مخزون المشروع</li>
                                        </ul>
                                        <div class="text-center mt-2">
                                            <div class="alert alert-success">
                                                <i class="fas fa-check-circle me-2"></i>
                                                اكتملت دورة المشتريات بنجاح وتم توثيق جميع المراحل في النظام
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- مسؤوليات المخزون وتتبع المواد -->
                    <div class="card border-warning mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h4 class="mb-0"><i class="fas fa-boxes me-2"></i>إدارة المخزون وتتبع المواد</h4>
                        </div>
                        <div class="card-body">
                            <p>بعد استلام المواد، يتم تخزينها وتتبعها داخل النظام:</p>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-header bg-light">
                                            <h5 class="mb-0">تسجيل المواد في المخزون</h5>
                                        </div>
                                        <div class="card-body">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item">
                                                    <i class="fas fa-plus-circle text-success me-2"></i>
                                                    إضافة المواد تلقائياً للمخزون بعد الاستلام
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-tag text-primary me-2"></i>
                                                    تصنيف المواد حسب النوع والاستخدام
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                                    تحديد موقع التخزين (مستودع، موقع المشروع)
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-qrcode text-info me-2"></i>
                                                    ترميز المواد الهامة لتسهيل التتبع
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-header bg-light">
                                            <h5 class="mb-0">تتبع استهلاك المواد</h5>
                                        </div>
                                        <div class="card-body">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item">
                                                    <i class="fas fa-random text-primary me-2"></i>
                                                    تسجيل عمليات صرف المواد للمشاريع
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-chart-line text-success me-2"></i>
                                                    تحليل معدلات الاستهلاك ومقارنتها بالتقديرات
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-bell text-warning me-2"></i>
                                                    إشعارات تلقائية عند انخفاض المخزون
                                                </li>
                                                <li class="list-group-item">
                                                    <i class="fas fa-file-invoice text-info me-2"></i>
                                                    إعداد تقارير المخزون الدورية
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h5 class="text-primary">فوائد الإدارة السليمة للمخزون</h5>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <div class="benefit-card">
                                            <div class="benefit-icon">
                                                <i class="fas fa-coins"></i>
                                            </div>
                                            <h6>تقليل التكاليف</h6>
                                            <p>منع الهدر وتحسين استخدام المواد يؤدي إلى خفض التكاليف</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="benefit-card">
                                            <div class="benefit-icon">
                                                <i class="fas fa-truck-loading"></i>
                                            </div>
                                            <h6>تجنب التأخيرات</h6>
                                            <p>توفر المواد في الوقت المناسب يمنع تأخير أعمال المشروع</p>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="benefit-card">
                                            <div class="benefit-icon">
                                                <i class="fas fa-clipboard-check"></i>
                                            </div>
                                            <h6>دقة التقارير</h6>
                                            <p>تقارير دقيقة عن تكاليف المواد والاستهلاك الفعلي</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form method="POST" action="{{ url_for('onboarding.wizard_step', step_num=current_step) }}">
                        <div class="d-flex justify-content-between mt-4">
                            {% if prev_step %}
                            <a href="{{ url_for('onboarding.wizard_step', step_num=prev_step) }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-right me-1"></i>
                                السابق
                            </a>
                            {% else %}
                            <a href="{{ url_for('onboarding.wizard_index') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-right me-1"></i>
                                العودة للصفحة الرئيسية
                            </a>
                            {% endif %}
                            <button type="submit" class="btn btn-primary">
                                إتمام المعالج
                                <i class="fas fa-check ms-1"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* تنسيق بطاقات الأدوار */
    .role-card {
        display: flex;
        margin-bottom: 20px;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .role-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .role-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
        margin-left: 15px;
        flex-shrink: 0;
    }
    
    .role-icon.site-engineer {
        background-color: #28a745;
    }
    
    .role-icon.storekeeper {
        background-color: #fd7e14;
    }
    
    .role-icon.project-manager {
        background-color: #007bff;
    }
    
    .role-icon.finance {
        background-color: #6f42c1;
    }
    
    .role-details {
        flex: 1;
    }
    
    .role-details h5 {
        margin-bottom: 10px;
        color: #343a40;
    }
    
    .role-details p {
        margin-bottom: 5px;
        font-weight: bold;
    }
    
    .role-details ul {
        padding-right: 20px;
        margin-bottom: 0;
    }
    
    .role-details li {
        margin-bottom: 5px;
    }
    
    /* تنسيق خطوات الاستلام */
    .delivery-process {
        position: relative;
        padding: 10px 0;
    }
    
    .delivery-step {
        display: flex;
        margin-bottom: 30px;
        position: relative;
    }
    
    .delivery-step:last-child {
        margin-bottom: 0;
    }
    
    .delivery-step .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #28a745;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: bold;
        margin-left: 20px;
        z-index: 2;
    }
    
    .delivery-step .step-content {
        flex: 1;
    }
    
    .delivery-step .step-content h5 {
        color: #28a745;
        margin-bottom: 10px;
    }
    
    /* خط عمودي يربط الخطوات */
    .delivery-process:before {
        content: "";
        position: absolute;
        top: 20px;
        bottom: 20px;
        right: 20px;
        width: 2px;
        background-color: #e0e0e0;
        z-index: 1;
    }
    
    /* تنسيق صورة الفحص */
    .inspection-img {
        max-width: 100%;
        height: auto;
        max-height: 150px;
        border-radius: 8px;
    }
    
    /* تنسيق بطاقات الفوائد */
    .benefit-card {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        height: 100%;
        transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .benefit-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .benefit-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: #17a2b8;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: L24px;
        margin: 0 auto 15px;
    }
    
    .benefit-card h6 {
        color: #343a40;
        margin-bottom: 10px;
        font-weight: bold;
    }
    
    .benefit-card p {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 0;
    }
    
    /* تنسيق يدعم الواجهة العربية RTL */
    .role-card, .delivery-step {
        text-align: right;
    }
    
    /* جعل القسم متجاوب مع الشاشات الصغيرة */
    @media (max-width: 768px) {
        .role-card {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .role-icon {
            margin: 0 0 15px 0;
        }
        
        .delivery-step {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .delivery-step .step-number {
            margin: 0 0 15px 0;
        }
        
        .delivery-process:before {
            display: none;
        }
    }
</style>
{% endblock %}