{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card border-primary shadow">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>
                        إنشاء طلب الشراء
                    </h3>
                    <span class="badge bg-light text-primary">الخطوة {{ current_step }} من {{ total_steps }}</span>
                </div>
                <div class="card-body p-4">
                    <!-- شريط التقدم -->
                    <div class="progress mb-4" style="height: 10px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ (current_step / total_steps) * 100 }}%;" 
                            aria-valuenow="{{ (current_step / total_steps) * 100 }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    <div class="text-center mb-4">
                        <img src="{{ url_for('static', filename='img/request.svg') }}" alt="طلب الشراء" class="img-fluid mb-3" style="max-height: 200px;">
                        <h2 class="text-primary">إنشاء وإدارة طلبات الشراء</h2>
                        <p class="text-muted">كيفية إنشاء طلبات الشراء وإدارتها في النظام</p>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-lg-12">
                            <div class="card border-light mb-3">
                                <div class="card-body">
                                    <h4 class="text-primary mb-3">من يمكنه إنشاء طلب شراء؟</h4>
                                    
                                    <div class="roles-section">
                                        <div class="role">
                                            <div class="role-icon engineer">
                                                <i class="fas fa-hard-hat"></i>
                                            </div>
                                            <div class="role-details">
                                                <h5>المهندس</h5>
                                                <p>يمكن للمهندسين إنشاء طلبات الشراء للمواد والمعدات اللازمة للمشاريع التي يعملون عليها.</p>
                                            </div>
                                        </div>
                                        
                                        <div class="role">
                                            <div class="role-icon manager">
                                                <i class="fas fa-user-tie"></i>
                                            </div>
                                            <div class="role-details">
                                                <h5>مدير المشروع</h5>
                                                <p>يمكن لمدير المشروع إنشاء طلبات الشراء للاحتياجات الأساسية للمشروع ككل.</p>
                                            </div>
                                        </div>
                                        
                                        <div class="role">
                                            <div class="role-icon admin">
                                                <i class="fas fa-user-shield"></i>
                                            </div>
                                            <div class="role-details">
                                                <h5>المدير</h5>
                                                <p>يمكن للمديرين إنشاء طلبات شراء لأي مشروع أو للاحتياجات العامة للشركة.</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="alert alert-info mt-4">
                                        <i class="fas fa-info-circle me-2"></i>
                                        جميع طلبات الشراء تخضع لدورة الموافقات حسب قيمتها والمشروع المرتبط بها.
                                    </div>
                                    
                                    <h4 class="text-primary mb-3 mt-5">كيفية إنشاء طلب شراء جديد</h4>
                                    
                                    <div class="create-request-steps">
                                        <div class="request-step">
                                            <div class="step-number">1</div>
                                            <div class="step-content">
                                                <h5>الوصول إلى نموذج طلب الشراء</h5>
                                                <p>انتقل إلى "طلبات الشراء" من القائمة الرئيسية، ثم انقر على زر "إضافة طلب شراء جديد"</p>
                                                <div class="text-center mt-2 mb-3">
                                                    <button class="btn btn-sm btn-primary" disabled>
                                                        <i class="fas fa-plus-circle me-1"></i>
                                                        إضافة طلب شراء جديد
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="request-step">
                                            <div class="step-number">2</div>
                                            <div class="step-content">
                                                <h5>إدخال المعلومات الأساسية</h5>
                                                <p>قم بتعبئة البيانات الأساسية للطلب:</p>
                                                <ul>
                                                    <li><strong>المشروع:</strong> اختر المشروع المرتبط بالطلب</li>
                                                    <li><strong>العنوان:</strong> عنوان وصفي مختصر للطلب</li>
                                                    <li><strong>الوصف:</strong> شرح تفصيلي لسبب الطلب وأهميته</li>
                                                    <li><strong>الأولوية:</strong> مستوى أهمية الطلب (عادي، مهم، عاجل)</li>
                                                    <li><strong>تاريخ الاحتياج:</strong> التاريخ المطلوب لتوفير المواد</li>
                                                </ul>
                                            </div>
                                        </div>
                                        
                                        <div class="request-step">
                                            <div class="step-number">3</div>
                                            <div class="step-content">
                                                <h5>إضافة بنود الطلب</h5>
                                                <p>أضف العناصر المطلوبة واحداً تلو الآخر:</p>
                                                <ul>
                                                    <li><strong>اسم البند:</strong> وصف للمادة المطلوبة</li>
                                                    <li><strong>الكمية:</strong> العدد المطلوب</li>
                                                    <li><strong>وحدة القياس:</strong> (قطعة، متر، كيلوجرام، الخ)</li>
                                                    <li><strong>المواصفات:</strong> تفاصيل فنية للمادة المطلوبة</li>
                                                    <li><strong>السعر التقديري:</strong> اختياري - إذا كان معروفاً</li>
                                                </ul>
                                                <div class="text-center mt-2 mb-3">
                                                    <button class="btn btn-sm btn-success" disabled>
                                                        <i class="fas fa-plus me-1"></i>
                                                        إضافة بند جديد
                                                    </button>
                                                </div>
                                                <div class="alert alert-warning">
                                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                                    يمكن إضافة عدة بنود في نفس طلب الشراء إذا كانت مرتبطة بنفس الغرض
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="request-step">
                                            <div class="step-number">4</div>
                                            <div class="step-content">
                                                <h5>إرفاق المستندات الداعمة</h5>
                                                <p>يمكنك إرفاق أي مستندات داعمة للطلب مثل:</p>
                                                <ul>
                                                    <li>رسومات فنية أو مخططات</li>
                                                    <li>عروض أسعار سابقة</li>
                                                    <li>كتالوجات منتجات</li>
                                                    <li>مواصفات فنية تفصيلية</li>
                                                </ul>
                                                <div class="alert alert-info">
                                                    <i class="fas fa-paperclip me-2"></i>
                                                    الملفات المدعومة: PDF، JPG، PNG، DOCX بحجم أقصى 5 ميجابايت
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="request-step">
                                            <div class="step-number">5</div>
                                            <div class="step-content">
                                                <h5>مراجعة وحفظ الطلب</h5>
                                                <p>قبل إرسال الطلب:</p>
                                                <ul>
                                                    <li>راجع جميع البيانات للتأكد من صحتها</li>
                                                    <li>تأكد من إدراج جميع البنود المطلوبة</li>
                                                    <li>اضغط على زر "حفظ" لإنشاء الطلب</li>
                                                </ul>
                                                <div class="text-center mt-2 mb-3">
                                                    <button class="btn btn-primary" disabled>
                                                        <i class="fas fa-save me-1"></i>
                                                        حفظ الطلب
                                                    </button>
                                                </div>
                                                <div class="alert alert-success">
                                                    <i class="fas fa-check-circle me-2"></i>
                                                    بعد حفظ الطلب، سيتم إرساله تلقائياً للمستوى الأول من الموافقات
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card border-warning mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>نصائح لإنشاء طلبات شراء فعالة</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item">
                                            <i class="fas fa-check text-success me-2"></i>
                                            كن محدداً في وصف المواد المطلوبة وخصائصها
                                        </li>
                                        <li class="list-group-item">
                                            <i class="fas fa-check text-success me-2"></i>
                                            اشرح سبب أهمية الطلب وتأثيره على سير المشروع
                                        </li>
                                        <li class="list-group-item">
                                            <i class="fas fa-check text-success me-2"></i>
                                            حدد تاريخ الاحتياج بدقة مع هامش زمني مناسب
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item">
                                            <i class="fas fa-check text-success me-2"></i>
                                            وفر جميع المستندات الداعمة لتسريع عملية الموافقة
                                        </li>
                                        <li class="list-group-item">
                                            <i class="fas fa-check text-success me-2"></i>
                                            قم بتجميع المواد المرتبطة في طلب واحد لتسهيل المشتريات
                                        </li>
                                        <li class="list-group-item">
                                            <i class="fas fa-check text-success me-2"></i>
                                            تابع حالة الطلب وكن مستعداً للإجابة على أي استفسارات
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form method="POST" action="{{ url_for('onboarding.wizard_step', step_num=current_step) }}">
                        <div class="d-flex justify-content-between mt-4">
                            {% if prev_step %}
                            <a href="{{ url_for('onboarding.wizard_step', step_num=prev_step) }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-right me-1"></i>
                                السابق
                            </a>
                            {% else %}
                            <a href="{{ url_for('onboarding.wizard_index') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-right me-1"></i>
                                العودة للصفحة الرئيسية
                            </a>
                            {% endif %}
                            <button type="submit" class="btn btn-primary">
                                التالي
                                <i class="fas fa-arrow-left ms-1"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* تنسيق قسم الأدوار */
    .roles-section {
        margin: 20px 0;
    }
    
    .role {
        display: flex;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
    }
    
    .role:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
    
    .role-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-left: 20px;
        color: white;
    }
    
    .role-icon.engineer {
        background-color: #4CAF50;
    }
    
    .role-icon.manager {
        background-color: #2196F3;
    }
    
    .role-icon.admin {
        background-color: #9C27B0;
    }
    
    .role-details {
        flex: 1;
    }
    
    .role-details h5 {
        margin-bottom: 5px;
        color: #333;
    }
    
    /* تنسيق خطوات إنشاء الطلب */
    .create-request-steps {
        margin-top: 20px;
    }
    
    .request-step {
        display: flex;
        margin-bottom: 30px;
        position: relative;
    }
    
    .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #2196F3;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: bold;
        margin-left: 20px;
        z-index: 2;
    }
    
    .step-content {
        flex: 1;
        padding: 0 10px;
    }
    
    .step-content h5 {
        color: #2196F3;
        margin-bottom: 10px;
    }
    
    /* خط عمودي يربط الخطوات */
    .create-request-steps {
        position: relative;
    }
    
    .create-request-steps:before {
        content: "";
        position: absolute;
        top: 20px;
        bottom: 20px;
        right: 20px;
        width: 2px;
        background-color: #e0e0e0;
        z-index: 1;
    }
    
    /* تنسيق يدعم الواجهة العربية RTL */
    .role, .request-step {
        text-align: right;
    }
    
    /* جعل القسم متجاوب مع الشاشات الصغيرة */
    @media (max-width: 768px) {
        .role {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .role-icon {
            margin: 0 0 15px 0;
        }
        
        .request-step {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .step-number {
            margin: 0 0 15px 0;
        }
        
        .create-request-steps:before {
            display: none;
        }
    }
</style>
{% endblock %}